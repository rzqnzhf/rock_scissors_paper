<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>Rock, Scissors, Paper !</title>

    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@900&display=swap" rel="stylesheet">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

</head>
<div id="header"></div>

<body>

    <h1>Rock, Scissors, Paper !</h1>

    <div class="playground">

        <div class="hand">
            <div class="who">
                <p class="whoText">CP</p>
            </div>
            <div class="icons">
                <img class="imgTool" id="cpRock" src="img/rock_a.png" alt="rock">
                <img class="imgTool" id="cpScissors" src="img/scissors_a.png" alt="scissors">
                <img class="imgTool" id="cpPaper" src="img/paper_a.png" alt="paper">
            </div>
            <div class="scores" id="cpScore">

            </div>
        </div>

        <p id="vs">
            VS
        </p>

        <div class="hand">
            <div class="who">
                <p class="whoText" id="you">YOU</p>
            </div>
            <div class="icons">
                <input type="image" class="imgTool" src="img/rock_a.png" onclick="start(this.id)" id="userRock">
                <input type="image" class="imgTool" src="img/scissors_a.png" onclick="start(this.id)" id="userScissors">
                <input type="image" class="imgTool" src="img/paper_a.png" onclick="start(this.id)" id="userPaper">
            </div>
            <div class="scores"  id="userScore">

            </div>
        </div>
        <div class="settingsButton">

            <label class="roundSettings">Max Rounds </label>
            <input class="roundSettings" id="maxRoundInput" type="number" min="1" max="10" value="3" onchange="refreshDot()">
            <input id="restartSettings" type="button" value="Restart" onclick="restart()">
        </div>
    </div>

    <script type="text/javascript">

        let cpHand;
        let userHand;
        let currentRound = 0;
        let maxRound = document.getElementById("maxRoundInput").value;

        refreshDot(maxRound);
        

        function start(clicked) {


            if (currentRound < maxRound) {
                document.getElementById(clicked).style.opacity = "100%";

                document.getElementById("userRock").disabled = true;
                document.getElementById("userScissors").disabled = true;
                document.getElementById("userPaper").disabled = true;

                cpTurn();

                currentRound++;

                setTimeout(function () {
                    document.getElementById(clicked).style.opacity = "50%";
                    document.getElementById("cpRock").style.opacity = "50%";
                    document.getElementById("cpScissors").style.opacity = "50%";
                    document.getElementById("cpPaper").style.opacity = "50%";
                }, 1500)

                setTimeout(function () {
                    document.getElementById("userRock").disabled = false;
                    document.getElementById("userScissors").disabled = false;
                    document.getElementById("userPaper").disabled = false;
                }, 1500)

                if (currentRound > maxRound) {

                    console.log("game ended")
                }
            }
            else {
                console.log("please restart")
            }



        }


        function cpTurn() {

            random = Math.floor(Math.random() * 2);
            console.log("Random" + random)
            switch (random) {
                case 0:
                    cpHand = "cpRock";
                    document.getElementById("cpScissors").style.opacity = "50%";
                    document.getElementById("cpPaper").style.opacity = "50%";
                    break;
                case 1:
                    cpHand = "cpScissors";
                    document.getElementById("cpRock").style.opacity = "50%";
                    document.getElementById("cpPaper").style.opacity = "50%";
                    break;
                case 2:
                    cpHand = "cpPaper";
                    document.getElementById("cpScissors").style.opacity = "50%";
                    document.getElementById("cpRock").style.opacity = "50%";
                    break;
            }
            console.log("cpTurn : " + cpHand);

            document.getElementById(cpHand).style.opacity = "100%";
            return cpHand;
        }

        function refreshDot(maxRound){

            let userScoreDot;

            maxRound = document.getElementById("maxRoundInput").value;

            if(document.getElementById("userScore").childElementCount > 0){
                deleteAllDot();
            }            
        
            for(i=0; i<maxRound; i++){
                
                userScoreDot = document.createElement("SPAN");
                userScoreDot.className = "dot";
                document.getElementById("userScore").appendChild(userScoreDot);
            }
            
        }

        function deleteAllDot(){

            console.log("deleting all node");

            let currentDots = document.getElementById("userScore");
            let currentDotsIds = currentDots.childElementCount;

            console.log("Ids : "+currentDots)
            console.log("max ID : "+currentDotsIds)

            for(i = currentDotsIds - 1; i>=0; i--){

                currentDots.removeChild(currentDots.childNodes[i]);  

                console.log(i);
            }
        }
        function restart(){
            deleteAllDot();
            refreshDot(maxRound);
        }

    </script>
</body>

</html>